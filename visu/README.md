---
title: Visu Plugin
summary: WebSocket interface for an jQuery mobile user interface.
layout: default
created: 2011-04-12T19:41:03+0200
changed: 2012-04-12T19:41:03+0200
---

This plugin provides an javascript interface for the JQuery mobile framework (shipping with 1.1.1 and jQuery 1.7.1). It has been tested with Chrome (18.0.1025.151), Firefox (11.0), Safari (5.1.5) and mobile Safari (iOS 5.1).
Right now the WebSocket interface of SmartHome.py only supports nonencrypted connections. Please use a internal network or VPN to connect to the service.

# Requirements
This plugin needs just a webserver to serve the HTML and JavaScript files for the GUI.
The example files in 'examples/visu' have to be placed in the _root directory_ of the webserver!

# Configuration

## plugin.conf
<pre>
[visu]
    class_name = WebSocket
    class_path = plugins.visu
#   ip='0.0.0.0'
#   port=2121
#   visu_dir = False
#   smartvisu_dir = False
</pre>

This plugins listens by default on every IP address of the host on the TCP port 2121.
The attribute `visu_dir` and `smartvisu_dir` are described in the subsection autogeneration.

## items.conf

Simply set the visu attribute to something to allow read/write access to the item. There are special keywords described in the subsection autogeneration.

<pre>
[example]
    [[toggle]]
        value = True
        type = bool
        visu = rw
</pre>

## logic.conf
You could specify the `visu` attribute to every logic in your logic.conf. This way you could trigger the logic via the interface.
<pre>
[dialog]
    filename = 'dialog.py'
    visu = true
</pre>

## Quickstart

   * set the the visu_dir in the plugin.conf to the root directory of you webserver e.g. `/var/www/visu`
   * copy the basic structure to the root directory `cp -r /usr/local/smarthome/examples/visu/* /var/www/visu/`
   * copy the example item configuration in your items directory `cp /usr/local/smarthome/examples/items/visu.conf /usr/local/smarthome/items/`
   * start SmartHome.py
   * goto http://yourserver/example.html


Functions
=========

## dialog(header, content)

This function opens a jQuery mobile dialog.
<pre>sh.visu.dialog('Easy', 'going')</pre> would create the following dialog on every client.
![dialog](/smarthome/img/dialog.png)

## url(url)

Change the current visu page to the specified url. e.g. `sh.visu.url('http://smarthome.local/door.html')`


User Interface
==============
See the [JQuery mobile](http://jquerymobile.com/) website for instructions how to build the interface. On the website is a interactive designer to get you started in no time.
There are several other graphical tools to build a website with JQuery mobile.

You could find an example in the `/usr/local/smarthome/examples/visu/` or have a look at the [noninteractive version](example.html) on this website.

See the `example.html` source for the structure of the header and the file. You have to load the minified `smarthome.min.js` or `smarthome.js` for debug output on the javascript console.

my.smarthome.js
---------------
You have to initialise the javascript to connect to the backbone. You could do this with `shInit("ws://"+ location.host + ":2121/");` which tries to open a WebSocket connection to the host (webserver) on port 2121.

HTML and data-sh
----------------
You could update the value or content of several HTML elements. Every element could be associated with an SmartHome.py item by adding the attribute `data-sh="area.item"` to the element.

The following elements are supported:

  * a: anchor for creating buttons to trigger logics. The `data-sh` has to set to the logic name as specified in the logic.conf.
  * div/span: update the content of the div/span
  * img: to update the `src` attribute of the element
  * input/textarea/select: to create forms

You could find every supported element and usage in the `example.html`.

## Autogeneration

### SmartHome.py

This feature generates the visu pages on the start of SmartHome.py. In our example the root directory of the webserver is `/var/www/visu`.
It needs at least two directories in this root directory:

   * `tpl`: has to contain two template files: header.html, footer.html
   * `gen`: this is the output directory where the autogenerated pages will be written to. The other files/directories in the root directory are untouched!

#### Visu Elements
You could find a example config file with supported elements in the examples directory (examples/items/visu.conf).

The following elements attribute values for `visu` in the items configuration are supported:

   * text: editable text field
   * textarea: editable text area
   * div, span: displays the values in a div or span
   * toggle: a basic flip switch. You could change the default labels ( 'Off', 'On') to something different with `visu_opt = 0, 1`.
   * slider: by default the slider value range is 0 - 100 with a stepping of 5. You could change the range and stepping with `visu_opt = min, max, step`.
   * select: with `visu_opt = value1, value2, value2, ...` you could define the select values.
   * radio: with `visu_opt = value1, value2, value2, ...` you could define the radio values.
   * checkbox: a simple checkbox for a bool type
   * img: generate an image element with the value of the item as image path.
   * push: special image element which set the item to True if you push the image element and false if you release it. You have to specify `visu_img = /path/to/false.img, /path/to/true.img`
   * switch: special image element acting as a switch. You have to specify `visu_img = /path/to/false.img, /path/to/true.img`
   * rrd: generate a plot with a default frame of one day.
   * list: shows the content of an array as a list (ul)
   * dpt3: push to control shutters and dim lights

### smartVISU

You could generate pages for the [smartVISU](http://code.google.com/p/smartvisu/) visualisation if you specify the `smartvisu_dir` which should be set to the root directory of your smartVISU installation.
In the examples directory you could find a configuration with every supported element. `examples/items/smartvisu.conf`  

The attribute keywords are:

   * sv_page: to generate a page for this item. You have to specify `sv_page = room` to activate it. Every widget beneath this item will be included in the page.
   * sv_img: with this attribute you could assign an icon or picture for a page or widget.
   * sv_widget: This has to be a double quoted encapsulated string with the smartVISU widget. You could define multiple widgets by separating them by a comma. See the example below:

<pre>
[second]
    [[sleeping]]
        name = Sleeping Room
        sv_page = room
        sv_img = scene_sleeping.png
        [[[light]]]
            name = Light
            type = bool
            visu = yes
            sv_widget = "&#123;&#123; device.dimmer('second.sleeping.light', 'Light', 'second.sleeping.light', 'second.sleeping.light.level') &#125;&#125;"
            knx_dpt = 1
            knx_listen = 3/2/12
            knx_send = 3/2/12
            [[[[level]]]]
                type = num
                visu = yes
                knx_dpt = 5
                knx_listen = 3/2/14
                knx_send = 3/2/14
</pre>

But instead of giving the widget distinct options you could use `item` as a keyword.
The page generator will replace it with the current path. This way you could easily copy widget calls and don't type the item path every time.
<pre>
[second]
    [[sleeping]]
        name = Sleeping Room
        sv_page = room
        sv_img = scene_sleeping.png
        [[[light]]]
            name = Light
            type = bool
            visu = yes
            sv_widget = "&#123;&#123; device.dimmer('item', 'item.name', 'item', 'item.level') &#125;&#125;"
            knx_dpt = 1
            knx_listen = 3/2/12
            knx_send = 3/2/12
            [[[[level]]]]
                type = num
                visu = yes
                knx_dpt = 5
                knx_listen = 3/2/14
                knx_send = 3/2/14
</pre>

